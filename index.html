<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Hệ Thống WebAR - Scalable</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* ... Copy lại CSS cũ của bạn vào đây ... */
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
    #info-panel { position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 100; background: rgba(10, 10, 10, 0.75); backdrop-filter: blur(8px); border-left: 3px solid #fff; padding: 10px 15px; border-radius: 6px; color: #fff; max-height: 25%; overflow-y: auto; word-wrap: break-word; opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
    #info-panel.visible { opacity: 1; transform: translateY(0); }
    #ui-title { margin: 0 0 4px 0; font-size: 16px; font-weight: 700; text-transform: uppercase; }
    #ui-desc { margin: 0; font-size: 13px; line-height: 1.4; color: #e0e0e0; text-align: left; }
  </style>

  <script src="./js/database.js"></script>   <script src="./js/components.js"></script> <script src="./js/main.js"></script>       </head>

  <script>
    // Component tạo hiệu ứng ánh sáng xoay dưới chân mô hình
    AFRAME.registerComponent('rotating-light', {
      init: function() {
        const el = document.createElement('a-image');
        // Đường dẫn ảnh: images/image1.png (Bạn cần đảm bảo file này tồn tại)
        el.setAttribute('src', 'assets/images/image1.png'); 
        el.setAttribute('width', '2.5'); // Kích thước rộng hơn target một chút để tỏa sáng
        el.setAttribute('height', '2.5');
        // Vị trí: 0 0.01 0 để nằm ngay trên bề mặt target nhưng dưới mô hình 3D
        el.setAttribute('position', '0 0.01 0'); 
        el.setAttribute('rotation', '-90 0 0'); // Đặt nằm ngang trên mặt phẳng
        // Blending additive giúp ảnh hòa trộn như ánh sáng, depthWrite false để không che lấp
        el.setAttribute('material', 'transparent: true; opacity: 0.8; blending: additive; depthWrite: false');
        
        // Animation xoay tròn siêu nhanh (300ms/vòng)
        el.setAttribute('animation', 'property: rotation; from: -90 0 0; to: -90 360 0; loop: true; dur: 300; easing: linear');
        
        this.el.appendChild(el);
      }
    });

    // Component tự động gắn hiệu ứng vào các entity có mindar-image-target
    AFRAME.registerComponent('auto-light-effect', {
      init: function() {
        this.el.addEventListener('child-attached', (e) => {
          const node = e.detail.el;
          if (node.nodeName === 'A-ENTITY' && node.hasAttribute('mindar-image-target')) {
            node.setAttribute('rotating-light', '');
          }
        });
      }
    });
  </script>

<body>
  <div id="info-panel"><div id="ui-title"></div><div id="ui-desc"></div></div>

  <a-scene
    auto-light-effect
    mindar-image="imageTargetSrc: ./targets.mind; filterMinCF:0.0001; filterBeta:0.001; uiLoading: no; autoStart: true;"
    renderer="colorManagement: true, physicallyCorrectLights"
    color-space="sRGB"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    embedded
  >
    <a-assets>
      </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    </a-scene>

  <script>
    // Code unlock audio nhỏ gọn để ở đây
    function unlockAudio() {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (AudioContext) { new AudioContext().resume(); }
      document.body.removeEventListener('click', unlockAudio);
      document.body.removeEventListener('touchstart', unlockAudio);
    }
    document.body.addEventListener('click', unlockAudio);
    document.body.addEventListener('touchstart', unlockAudio);
  </script>
</body>
</html>